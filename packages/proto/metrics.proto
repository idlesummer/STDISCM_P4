syntax = "proto3";
package services;

message Metric {
  int32 epoch       = 1;
  int32 batch       = 2;
  int32 batch_size  = 3;
  float batch_loss  = 4;
  repeated int32 predictions = 5;
  repeated int32 truths      = 6;
}

message SubscribeRequest {
  // Empty for now, can add filters later
}

message StartTrainingRequest {
  int32 num_epochs = 1;  // Number of epochs to train
}

message StartTrainingReply {
  string status = 1;  // e.g., "ready", "already_running"
  string message = 2; // Additional info
}

message ConfirmTrainingRequest {
  bool confirmed = 1;  // true to proceed, false to cancel
}

message ConfirmTrainingReply {
  string status = 1;  // e.g., "started", "cancelled", "not_ready"
}

message PublishReply {
  string status = 1; // e.g., "ok"
}

service Metrics {
  // Step 1: Client requests training with parameters
  rpc StartTraining (StartTrainingRequest) returns (StartTrainingReply);

  // Step 2: Client confirms to actually begin training
  rpc ConfirmTraining (ConfirmTrainingRequest) returns (ConfirmTrainingReply);

  // Client subscribes to stream of metrics from server
  rpc Subscribe (SubscribeRequest) returns (stream Metric);

  // Push model: client sends metrics to server (kept for compatibility)
  rpc Publish (Metric) returns (PublishReply);
}
