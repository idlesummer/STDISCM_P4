syntax = "proto3";
package services;


// =========================
// ======== MESSAGES =======
// =========================

message TrainingMetric {
  int32 epoch           = 1;
  int32 batch           = 2;
  int32 batch_size      = 3;
  float batch_loss      = 4;
  repeated int32 preds  = 5;
  repeated int32 truths = 6;
  repeated float scores = 7;  // Confidence scores for predictions
}

message SubscribeReq {
  // Empty for now, can add filters later
}

message StatusReq {
  // Empty - just checking server status
}

message StatusRes {
  string status  = 1;   // "ready", "training", "idle"
  string message = 2;   // Additional info
  int32 epoch    = 3;   // If training, which epoch (0 if not training)
}

message StartReq {
  int32 num_epochs = 1; // Number of epochs to train
  bool confirmed = 2;   // Must be true to actually start
}

message StartRes {
  string status = 1;    // "started", "already_running", "not_confirmed"
  string message = 2;   // Additional info
}


// =========================
// ======== SERVICE ========
// =========================

service Training {
  // Check server status (handshake)
  rpc Status (StatusReq) returns (StatusRes);

  // Start training with epochs and confirmation (stateless)
  rpc Start (StartReq) returns (StartRes);

  // Client subscribes to stream of metrics from server
  rpc Subscribe (SubscribeReq) returns (stream TrainingMetric);
}
